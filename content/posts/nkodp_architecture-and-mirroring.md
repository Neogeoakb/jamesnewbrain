Title: NKODP - project architecture and first mirror
Date: 2014-03-31 12:26
Modified: 2014-03-31 12:26
Category: NKODP
Tags: NKODP
Slug: NKODP_project-architecture-and-first-mirror
disqus_identifier: NKODP_project-architecture-and-first-mirror
Author: James Fallisgaard
Status: draft
Summary: NKODP - introduction to project’s architecture, first mirror collector

I plan this.

##

## Requirements

### for production mode

- wget \*
- git
- virtualenv (Python with Pip)

### for development mode

- nginx \*

*with \* signifying that on Mac OS, required software will have the following prerequisites:*

- xcode command line tools (if on Mac OS)
- Homebrew

***

## Installation

### Running on a server (production) or locally (development)

1. clone this repo locally
2. `make install`
3. `make seed-mirror`
4. add runs of `make update` to a scheduler like `cron`, daily

### Continue if running locally (development)

5. `make install-dev`
6. set up `nginx` to serve `http://localhost` with your development site mirror, for example by creating a symbolic link with `sudo ln -s ~/dev/nkir/test/mirror_kcna/www.kcna.co.jp /private/var/www/kcna.co.jp/public_html`.

Now you can update your local copy with `make update-dev` to pull from your local version of the site instead.

# Below is a map of the NKIR project directory structure.

    nkir/                                                                   github checkout
    ├── data/                           holds data throughout pipelines
    |   ├── collector_kcna/             separate sections by "collector"
    |   |   ├── inbox_dbimport/
    |   |   |   └── 20140326-23.json    JSON data to be imported            `make json`
    |   |   ├── inbox_json/
    |   |   |   └── 20140326.23.html    new HTML article from mirror        `make queue`
    |   |   └── mirror/
    |   |       └── www.kcna.co.jp/     local mirror of www.kcna.co.jp/     `make kcna_mirror`
    |   └── collector_xyz/
    ├── doc/                            put all documentation               github checkout
    |   ├── pelican_site/               src of pelican blog
    |   └── nkir.md                     comprehensive documentation
    ├── env/                            Python virtualenv                   `make install`
    ├── etc/                            local configuration files           github checkout
    |   └── nkir.ini                    config for this machine             github checkout
    ├── src/                            source code                         github checkout
    |   ├── api/                        RESTful API to access our data
    |   ├── collectors/
    |   |   ├── collector_kcna/
    |   |   |   ├── dbimporter_kcna.py  import JSON data to database
    |   |   |   ├── jsonifier_kcna.py   parsed article HTML->JSON
    |   |   |   ├── mirror_kcna.sh      mirror www.kcna.co.jp locally
    |   |   |   └── queuer_kcna.sh      queue article HTML for processing
    |   |   └── collector_xyz/
    |   ├── database/                   house source code modeling database
    |   └── reporters/                  get from API->publish viz
    ├── srv/                            anything we host online / publish
    |   ├── api/                        built/deployed API                  `make api`
    |   ├── database/                   built/deployed/live database        `make database`
    |   ├── pelican_site/               built/deployed/live website         `make html`
    |   └── reports/                    built and published reports / viz's
    ├── test/                           house anything required for testing
    |   └── mirror_kcna/                                                    `make install-dev`
    |       └── www.kcna.co.jp/         kcna mirror @ http://localhost      `make kcna_mirror_dev`
    ├── var/                            files not github versioned or populated with `make`
    |   ├── archives/
    |   |   └── www.kcna.co.jp.zip      archive zip to upload to dropbox    `make backup`
    |   ├── datasets/                   infrequently updating datasets
    |   |   └── gov_data.tar.bz
    |   └── logs/                       logs generated by `nkir` utils
    |       ├── git_timestamp.log
    |       ├── wget_timestamp.log
    |       └── etc.log
    ├── .gitignore
    ├── LICENSE                         MIT OSS license
    ├── Makefile                        wrapper to process data
    ├── README.md                       github readme
    └── requirements.txt                pip dependencies
